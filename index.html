<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Impostor - Juego de Palabras</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Juego social de deducci√≥n y palabra secreta para 3-12 jugadores">
  <style>
    :root {
      color-scheme: dark;
      --bg: #050816;
      --bg-alt: #0b1020;
      --accent: #28e0a9;
      --accent-soft: rgba(40,224,169,0.15);
      --danger: #ff4b6a;
      --text: #f5f5f5;
      --muted: #a0a4b8;
      --card: #11172a;
      --border: #22263a;
      --radius: 14px;
      --shadow-soft: 0 18px 45px rgba(0,0,0,0.45);
      --shadow-inner: inset 0 0 0 1px rgba(255,255,255,0.03);
      --transition: 0.2s ease;
    }
    
    *, *::before, *::after {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: radial-gradient(circle at top, #122149 0, #050816 55%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
    }
    
    .app {
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--accent);
      color: var(--bg);
      padding: 8px;
      text-decoration: none;
      z-index: 100;
    }
    
    .skip-link:focus {
      top: 0;
    }
    
    header {
      text-align: center;
      padding: 8px 8px 4px;
    }
    
    header h1 {
      margin: 6px 0;
      font-size: 1.4rem;
      letter-spacing: 0.04em;
    }
    
    header p {
      margin: 0;
      font-size: 0.85rem;
      color: var(--muted);
    }
    
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 12px;
    }
    
    .card {
      background: linear-gradient(145deg, #11172a, #090d1a);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft), var(--shadow-inner);
      padding: 18px 16px 16px;
      border: 1px solid var(--border);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .card-title {
      font-size: 0.95rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--muted);
    }
    
    .chip {
      font-size: 0.75rem;
      padding: 3px 9px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      border: 1px solid rgba(40,224,169,0.5);
    }
    
    .chip-imp {
      background: rgba(255,75,106,0.18);
      color: var(--danger);
      border-color: rgba(255,75,106,0.7);
    }
    
    h2 {
      margin: 8px 0 6px;
      font-size: 1.1rem;
    }
    
    p {
      margin: 6px 0;
      font-size: 0.9rem;
      line-height: 1.5;
    }
    
    .muted {
      color: var(--muted);
      font-size: 0.83rem;
    }
    
    .center {
      text-align: center;
    }
    
    .word {
      font-size: 1.6rem;
      font-weight: 600;
      text-align: center;
      letter-spacing: 0.04em;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px dashed rgba(255,255,255,0.18);
      background: radial-gradient(circle at top, rgba(40,224,169,0.12), transparent 55%);
      margin: 8px 0 6px;
    }
    
    .word-secret {
      letter-spacing: 0.18em;
      font-size: 1.15rem;
    }
    
    .word-hint {
      font-size: 1.3rem;
      color: var(--danger);
      border-color: rgba(255,75,106,0.4);
      background: radial-gradient(circle at top, rgba(255,75,106,0.12), transparent 55%);
    }
    
    .btn-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    
    button {
      border: none;
      border-radius: 999px;
      padding: 11px 16px;
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      color: #050816;
      background: linear-gradient(135deg, #28e0a9, #7bf7e0);
      box-shadow: 0 12px 24px rgba(40,224,169,0.35);
      width: 100%;
      transition: transform var(--transition), box-shadow var(--transition), filter var(--transition);
    }
    
    button:hover:not(:disabled) {
      filter: brightness(1.1);
    }
    
    button:active:not(:disabled) {
      transform: translateY(1px) scale(0.985);
      box-shadow: 0 6px 12px rgba(0,0,0,0.6);
    }
    
    button:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    button.secondary {
      background: transparent;
      color: var(--muted);
      border: 1px solid rgba(255,255,255,0.16);
      box-shadow: none;
      text-transform: none;
      letter-spacing: 0.03em;
      font-weight: 500;
    }
    
    button.danger {
      background: linear-gradient(135deg, #ff4b6a, #ff8ba1);
      color: #fff;
      box-shadow: 0 12px 24px rgba(255,75,106,0.45);
    }
    
    .field {
      margin: 8px 0 4px;
    }
    
    .field label {
      display: block;
      font-size: 0.83rem;
      color: var(--muted);
      margin-bottom: 4px;
    }
    
    .field input,
    .field select {
      width: 100%;
      padding: 9px 11px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(3,6,18,0.9);
      color: var(--text);
      font-size: 0.9rem;
      outline: none;
      transition: border-color var(--transition);
    }
    
    .field input:focus,
    .field select:focus {
      border-color: var(--accent);
    }
    
    .field input:invalid {
      border-color: var(--danger);
    }
    
    .badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }
    
    .badge {
      font-size: 0.78rem;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      color: var(--muted);
    }
    
    .players-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    
    .players-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
      gap: 8px;
      margin-top: 10px;
    }
    
    .player-pill {
      position: relative;
      padding: 9px 11px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      font-size: 0.8rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2px;
      background: linear-gradient(145deg, rgba(12,16,40,0.9), rgba(6,10,24,0.95));
      cursor: pointer;
      color: var(--muted);
      transition: all var(--transition);
      text-align: center;
    }
    
    .player-pill:hover {
      transform: scale(1.05);
    }
    
    .player-pill:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    
    .player-pill .player-number {
      font-weight: 600;
      color: var(--accent);
      font-size: 0.75rem;
    }
    
    .player-pill .player-name {
      font-weight: 600;
      color: #fff;
      font-size: 0.85rem;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .player-pill.selected {
      border-color: rgba(255,75,106,0.9);
      box-shadow: 0 0 0 1px rgba(255,75,106,0.65);
      background: linear-gradient(145deg, rgba(255,75,106,0.15), rgba(255,75,106,0.05));
    }
    
    .player-pill.selected .player-name {
      color: #ffd7de;
    }
    
    .steps {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin-top: 6px;
    }
    
    .dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: rgba(255,255,255,0.16);
      transition: all var(--transition);
    }
    
    .dot.active {
      background: var(--accent);
      box-shadow: 0 0 12px rgba(40,224,169,0.9);
    }
    
    footer {
      text-align: center;
      font-size: 0.72rem;
      color: var(--muted);
      padding: 6px 0 2px;
    }
    
    footer a {
      color: var(--accent);
      text-decoration: none;
    }
    
    .player-name-display {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--accent);
      text-align: center;
      margin: 8px 0;
      padding: 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      border: 1px solid rgba(40,224,169,0.3);
    }
    
    .category-display {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--accent);
      text-align: center;
      margin: 10px 0 6px;
      padding: 6px 12px;
      border-radius: 999px;
      background: var(--accent-soft);
      border: 1px solid rgba(40,224,169,0.3);
      display: inline-block;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin: 10px 0;
    }
    
    .stat-box {
      background: rgba(40,224,169,0.08);
      border: 1px solid rgba(40,224,169,0.2);
      border-radius: 12px;
      padding: 10px;
      text-align: center;
    }
    
    .stat-number {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--accent);
      display: block;
    }
    
    .stat-label {
      font-size: 0.75rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    @media (min-height: 780px) {
      .app { 
        padding-top: 20px; 
        padding-bottom: 18px; 
      }
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .card {
      animation: fadeIn 0.3s ease;
    }
  </style>
</head>
<body>
  <a href="#main" class="skip-link">Saltar al contenido principal</a>
  
  <div class="app">
    <header role="banner">
      <h1>IMPOSTOR ¬∑ WEB</h1>
      <p>Juego social de palabra secreta, deducci√≥n y enga√±o</p>
    </header>

    <main id="main" role="main"></main>

    <footer role="contentinfo">
      Modo local "pasar el m√≥vil". 12 categor√≠as ¬∑ 420 palabras.
    </footer>
  </div>

<script>
  'use strict';

  const CONFIG = {
    STORAGE_KEY: "impostor-web-opts-v4",
    MIN_PLAYERS: 3,
    MAX_PLAYERS: 24,
    DEFAULT_PLAYERS: 5
  };

  const WORD_CATEGORIES = {
    "Comida": [
      {word: "PIZZA", hint: "PASTA"}, {word: "HAMBURGUESA", hint: "BOCADILLO"}, {word: "ENSALADA", hint: "VERDURA"},
      {word: "SUSHI", hint: "ARROZ"}, {word: "PAELLA", hint: "FIDEU√Å"}, {word: "TORTILLA", hint: "HUEVO"},
      {word: "CHOCOLATE", hint: "CACAO"}, {word: "HELADO", hint: "POSTRE"}, {word: "CAF√â", hint: "BEBIDA"},
      {word: "TARTA", hint: "DULCE"}, {word: "PASTA", hint: "ESPAGUETI"}, {word: "QUESO", hint: "L√ÅCTEO"},
      {word: "JAM√ìN", hint: "EMBUTIDO"}, {word: "PAN", hint: "HARINA"}, {word: "ARROZ", hint: "CEREAL"},
      {word: "PESCADO", hint: "MERLUZA"}, {word: "CARNE", hint: "FILETE"}, {word: "FRUTA", hint: "MANZANA"},
      {word: "VERDURA", hint: "LECHUGA"}, {word: "SOPA", hint: "CALDO"}, {word: "BOCADILLO", hint: "SANDWICH"},
      {word: "GALLETA", hint: "BIZCOCHO"}, {word: "YOGUR", hint: "LECHE"}, {word: "ZUMO", hint: "NARANJA"},
      {word: "MIEL", hint: "AZ√öCAR"}, {word: "PATATAS", hint: "TUB√âRCULO"}, {word: "FRESA", hint: "FRUTO"},
      {word: "POLLO", hint: "AVE"}, {word: "AT√öN", hint: "CONSERVA"}, {word: "MANTEQUILLA", hint: "GRASA"},
      {word: "TOMATE", hint: "HORTALIZA"}, {word: "PEPINO", hint: "VEGETAL"}, {word: "MA√çZ", hint: "GRANO"},
      {word: "NUEZ", hint: "FRUTO SECO"}, {word: "HUEVO", hint: "PROTE√çNA"}
    ],
    "Lugares": [
      {word: "PLAYA", hint: "COSTA"}, {word: "MONTA√ëA", hint: "SIERRA"}, {word: "COLEGIO", hint: "ESCUELA"},
      {word: "OFICINA", hint: "TRABAJO"}, {word: "RESTAURANTE", hint: "BAR"}, {word: "AEROPUERTO", hint: "TERMINAL"},
      {word: "MUSEO", hint: "GALER√çA"}, {word: "HOSPITAL", hint: "CL√çNICA"}, {word: "PARQUE", hint: "JARD√çN"},
      {word: "SUPERMERCADO", hint: "TIENDA"}, {word: "CINE", hint: "TEATRO"}, {word: "BIBLIOTECA", hint: "LIBRER√çA"},
      {word: "GIMNASIO", hint: "POLIDEPORTIVO"}, {word: "PISCINA", hint: "BALNEARIO"}, {word: "ESTADIO", hint: "CAMPO"},
      {word: "HOTEL", hint: "HOSTAL"}, {word: "BANCO", hint: "CAJERO"}, {word: "FARMACIA", hint: "DROGUER√çA"},
      {word: "IGLESIA", hint: "CATEDRAL"}, {word: "PLAZA", hint: "AVENIDA"}, {word: "MERCADO", hint: "MERCADILLO"},
      {word: "PUERTO", hint: "MUELLE"}, {word: "ESTACI√ìN", hint: "AND√âN"}, {word: "UNIVERSIDAD", hint: "CAMPUS"},
      {word: "ZOOL√ìGICO", hint: "SAFARI"}, {word: "BOSQUE", hint: "SELVA"}, {word: "DESIERTO", hint: "DUNAS"},
      {word: "VOLC√ÅN", hint: "CR√ÅTER"}, {word: "R√çO", hint: "ARROYO"}, {word: "LAGO", hint: "LAGUNA"},
      {word: "CUEVA", hint: "GRUTA"}, {word: "CASTILLO", hint: "FORTALEZA"}, {word: "PUENTE", hint: "VIADUCTO"},
      {word: "CIUDAD", hint: "METR√ìPOLI"}, {word: "PUEBLO", hint: "ALDEA"}
    ],
    "Objetos": [
      {word: "M√ìVIL", hint: "TEL√âFONO"}, {word: "LLAVE", hint: "CERRADURA"}, {word: "LIBRO", hint: "REVISTA"},
      {word: "GAFAS", hint: "LENTE"}, {word: "ORDENADOR", hint: "PANTALLA"}, {word: "SILLA", hint: "TABURETE"},
      {word: "MESA", hint: "ESCRITORIO"}, {word: "RELOJ", hint: "CRON√ìMETRO"}, {word: "AURICULARES", hint: "CASCOS"},
      {word: "MOCHILA", hint: "BOLSO"}, {word: "L√ÅMPARA", hint: "LUZ"}, {word: "ESPEJO", hint: "CRISTAL"},
      {word: "ALMOHADA", hint: "COJ√çN"}, {word: "MANTA", hint: "COLCHA"}, {word: "PARAGUAS", hint: "IMPERMEABLE"},
      {word: "BOTELLA", hint: "VASO"}, {word: "CUCHILLO", hint: "TENEDOR"}, {word: "PLATO", hint: "BANDEJA"},
      {word: "C√ÅMARA", hint: "FOTO"}, {word: "TELEVISI√ìN", hint: "MONITOR"}, {word: "RADIO", hint: "ALTAVOZ"},
      {word: "CALCULADORA", hint: "√ÅBACO"}, {word: "CALENDARIO", hint: "AGENDA"}, {word: "CARTERA", hint: "MONEDERO"},
      {word: "LINTERNA", hint: "FOCO"}, {word: "PINCEL", hint: "BROCHA"}, {word: "TIJERAS", hint: "CORTADOR"},
      {word: "MARTILLO", hint: "HERRAMIENTA"}, {word: "TORNILLO", hint: "CLAVO"}, {word: "REGLA", hint: "ESCUADRA"},
      {word: "BOL√çGRAFO", hint: "PLUMA"}, {word: "L√ÅPIZ", hint: "GRAFITO"}, {word: "GOMA", hint: "BORRADOR"},
      {word: "TAZA", hint: "JARRA"}, {word: "SART√âN", hint: "CACEROLA"}
    ],
    "Animales": [
      {word: "PERRO", hint: "CACHORRO"}, {word: "GATO", hint: "FELINO"}, {word: "LE√ìN", hint: "TIGRE"},
      {word: "ELEFANTE", hint: "MAMUT"}, {word: "PEZ", hint: "PIRA√ëA"}, {word: "P√ÅJARO", hint: "CANARIO"},
      {word: "CABALLO", hint: "YEGUA"}, {word: "RANA", hint: "SAPO"}, {word: "OSO", hint: "PANDA"},
      {word: "MONO", hint: "CHIMPANC√â"}, {word: "VACA", hint: "TORO"}, {word: "OVEJA", hint: "CORDERO"},
      {word: "CERDO", hint: "JABAL√ç"}, {word: "CONEJO", hint: "LIEBRE"}, {word: "RAT√ìN", hint: "RATA"},
      {word: "SERPIENTE", hint: "COBRA"}, {word: "COCODRILO", hint: "CAIM√ÅN"}, {word: "√ÅGUILA", hint: "HALC√ìN"},
      {word: "TIBUR√ìN", hint: "BALLENA"}, {word: "DELF√çN", hint: "ORCA"}, {word: "MARIPOSA", hint: "POLILLA"},
      {word: "HORMIGA", hint: "ABEJA"}, {word: "ARA√ëA", hint: "ESCORPI√ìN"}, {word: "TORTUGA", hint: "GAL√ÅPAGO"},
      {word: "PING√úINO", hint: "FOCA"}, {word: "JIRAFA", hint: "CEBRA"}, {word: "RINOCERONTE", hint: "HIPOP√ìTAMO"},
      {word: "CANGURO", hint: "KOALA"}, {word: "LOBO", hint: "ZORRO"}, {word: "B√öHO", hint: "LECHUZA"},
      {word: "LORO", hint: "PAPAGAYO"}, {word: "PATO", hint: "GANSO"}, {word: "GALLINA", hint: "GALLO"},
      {word: "CAMELLO", hint: "DROMEDARIO"}, {word: "PULPO", hint: "CALAMAR"}
    ],
    "Profesiones": [
      {word: "M√âDICO", hint: "ENFERMERO"}, {word: "PROFESOR", hint: "MAESTRO"}, {word: "COCINERO", hint: "CHEF"},
      {word: "BOMBERO", hint: "RESCATISTA"}, {word: "POLIC√çA", hint: "GUARDIA"}, {word: "ABOGADO", hint: "JUEZ"},
      {word: "INGENIERO", hint: "ARQUITECTO"}, {word: "ARTISTA", hint: "PINTOR"}, {word: "M√öSICO", hint: "CANTANTE"},
      {word: "DEPORTISTA", hint: "ATLETA"}, {word: "ACTOR", hint: "COMEDIANTE"}, {word: "ESCRITOR", hint: "PERIODISTA"},
      {word: "FOT√ìGRAFO", hint: "CAMAR√ìGRAFO"}, {word: "PILOTO", hint: "AZAFATA"}, {word: "CONDUCTOR", hint: "TAXISTA"},
      {word: "AGRICULTOR", hint: "GANADERO"}, {word: "CARPINTERO", hint: "ALBA√ëIL"}, {word: "ELECTRICISTA", hint: "FONTANERO"},
      {word: "MEC√ÅNICO", hint: "SOLDADOR"}, {word: "PELUQUERO", hint: "BARBERO"}, {word: "VENDEDOR", hint: "COMERCIANTE"},
      {word: "BANQUERO", hint: "CONTADOR"}, {word: "CIENT√çFICO", hint: "QU√çMICO"}, {word: "VETERINARIO", hint: "BI√ìLOGO"},
      {word: "PROGRAMADOR", hint: "DISE√ëADOR"}, {word: "DENTISTA", hint: "ORTODONCISTA"}, {word: "PSIC√ìLOGO", hint: "TERAPEUTA"},
      {word: "FARMAC√âUTICO", hint: "QU√çMICO"}, {word: "JARDINERO", hint: "FLORISTA"}, {word: "PANADERO", hint: "PASTELERO"},
      {word: "CARTERO", hint: "MENSAJERO"}, {word: "BIBLIOTECARIO", hint: "ARCHIVISTA"}, {word: "TRADUCTOR", hint: "INT√âRPRETE"},
      {word: "DETECTIVE", hint: "INVESTIGADOR"}, {word: "ASTRONAUTA", hint: "COSMONAUTA"}
    ],
    "Deportes": [
      {word: "F√öTBOL", hint: "BAL√ìN"}, {word: "BALONCESTO", hint: "CANASTA"}, {word: "TENIS", hint: "RAQUETA"},
      {word: "NATACI√ìN", hint: "PISCINA"}, {word: "CICLISMO", hint: "BICICLETA"}, {word: "ATLETISMO", hint: "CARRERA"},
      {word: "VOLEIBOL", hint: "RED"}, {word: "RUGBY", hint: "OVAL"}, {word: "B√âISBOL", hint: "BATE"},
      {word: "GOLF", hint: "HOYO"}, {word: "BOXEO", hint: "GUANTE"}, {word: "ESQU√ç", hint: "NIEVE"},
      {word: "SURF", hint: "OLA"}, {word: "ESCALADA", hint: "MONTA√ëA"}, {word: "YOGA", hint: "MEDITACI√ìN"},
      {word: "GIMNASIA", hint: "BARRA"}, {word: "HOCKEY", hint: "DISCO"}, {word: "PATINAJE", hint: "HIELO"},
      {word: "ESGRIMA", hint: "ESPADA"}, {word: "JUDO", hint: "TATAMI"}, {word: "K√ÅRATE", hint: "CINTUR√ìN"},
      {word: "PARACAIDISMO", hint: "CA√çDA"}, {word: "BUCEO", hint: "MAR"}, {word: "EQUITACI√ìN", hint: "CABALLO"},
      {word: "MARAT√ìN", hint: "RESISTENCIA"}, {word: "SNOWBOARD", hint: "TABLA"}, {word: "REMO", hint: "PALA"},
      {word: "HALTEROFILIA", hint: "PESAS"}, {word: "TRIATL√ìN", hint: "COMBINADO"}, {word: "POLO", hint: "MALLETE"},
      {word: "BADMINTON", hint: "VOLANTE"}, {word: "ARCO", hint: "FLECHA"}, {word: "BOLOS", hint: "PIN"},
      {word: "DARDOS", hint: "DIANA"}, {word: "AJEDREZ", hint: "TABLERO"}
    ],
    "Pa√≠ses": [
      {word: "ESPA√ëA", hint: "MADRID"}, {word: "FRANCIA", hint: "PAR√çS"}, {word: "ITALIA", hint: "ROMA"},
      {word: "ALEMANIA", hint: "BERL√çN"}, {word: "PORTUGAL", hint: "LISBOA"}, {word: "INGLATERRA", hint: "LONDRES"},
      {word: "GRECIA", hint: "ATENAS"}, {word: "RUSIA", hint: "MOSC√ö"}, {word: "CHINA", hint: "PEK√çN"},
      {word: "JAP√ìN", hint: "TOKIO"}, {word: "INDIA", hint: "DELHI"}, {word: "BRASIL", hint: "BRASILIA"},
      {word: "ARGENTINA", hint: "BUENOS AIRES"}, {word: "M√âXICO", hint: "CIUDAD"}, {word: "CANAD√Å", hint: "OTTAWA"},
      {word: "AUSTRALIA", hint: "CANBERRA"}, {word: "EGIPTO", hint: "CAIRO"}, {word: "MARRUECOS", hint: "RABAT"},
      {word: "TURQU√çA", hint: "ANKARA"}, {word: "HOLANDA", hint: "AMSTERDAM"}, {word: "B√âLGICA", hint: "BRUSELAS"},
      {word: "SUIZA", hint: "BERNA"}, {word: "AUSTRIA", hint: "VIENA"}, {word: "SUECIA", hint: "ESTOCOLMO"},
      {word: "NORUEGA", hint: "OSLO"}, {word: "DINAMARCA", hint: "COPENHAGUE"}, {word: "FINLANDIA", hint: "HELSINKI"},
      {word: "POLONIA", hint: "VARSOVIA"}, {word: "IRLANDA", hint: "DUBL√çN"}, {word: "ESCOCIA", hint: "EDIMBURGO"},
      {word: "ISLANDIA", hint: "REIKIAVIK"}, {word: "PER√ö", hint: "LIMA"}, {word: "CHILE", hint: "SANTIAGO"},
      {word: "COLOMBIA", hint: "BOGOT√Å"}, {word: "CUBA", hint: "HABANA"}
    ],
    "Tecnolog√≠a": [
      {word: "INTERNET", hint: "WEB"}, {word: "ORDENADOR", hint: "COMPUTADORA"}, {word: "SMARTPHONE", hint: "TEL√âFONO"},
      {word: "TABLET", hint: "PANTALLA"}, {word: "RAT√ìN", hint: "CURSOR"}, {word: "TECLADO", hint: "TECLA"},
      {word: "IMPRESORA", hint: "PAPEL"}, {word: "ESC√ÅNER", hint: "DIGITALIZAR"}, {word: "ROUTER", hint: "WIFI"},
      {word: "CABLE", hint: "CONEXI√ìN"}, {word: "USB", hint: "MEMORIA"}, {word: "DISCO", hint: "ALMACENAMIENTO"},
      {word: "PROCESADOR", hint: "CPU"}, {word: "MEMORIA", hint: "RAM"}, {word: "PANTALLA", hint: "MONITOR"},
      {word: "C√ÅMARA", hint: "LENTE"}, {word: "MICR√ìFONO", hint: "AUDIO"}, {word: "ALTAVOZ", hint: "SONIDO"},
      {word: "AURICULARES", hint: "M√öSICA"}, {word: "BATER√çA", hint: "ENERG√çA"}, {word: "CARGADOR", hint: "CORRIENTE"},
      {word: "SOFTWARE", hint: "PROGRAMA"}, {word: "APLICACI√ìN", hint: "APP"}, {word: "NAVEGADOR", hint: "CHROME"},
      {word: "CORREO", hint: "EMAIL"}, {word: "VIDEOJUEGO", hint: "CONSOLA"}, {word: "DRON", hint: "VUELO"},
      {word: "ROBOT", hint: "AUTOM√ÅTICO"}, {word: "SAT√âLITE", hint: "√ìRBITA"}, {word: "L√ÅSER", hint: "HAZ"},
      {word: "BLUETOOTH", hint: "INAL√ÅMBRICO"}, {word: "SERVIDOR", hint: "HOSTING"}, {word: "FIREWALL", hint: "SEGURIDAD"},
      {word: "ANTIVIRUS", hint: "PROTECCI√ìN"}, {word: "ALGORITMO", hint: "C√ìDIGO"}
    ],
    "Naturaleza": [
      {word: "√ÅRBOL", hint: "TRONCO"}, {word: "FLOR", hint: "P√âTALO"}, {word: "HOJA", hint: "RAMA"},
      {word: "SEMILLA", hint: "GRANO"}, {word: "C√âSPED", hint: "HIERBA"}, {word: "NUBE", hint: "CIELO"},
      {word: "SOL", hint: "ESTRELLA"}, {word: "LUNA", hint: "SAT√âLITE"}, {word: "LLUVIA", hint: "AGUA"},
      {word: "NIEVE", hint: "COPO"}, {word: "VIENTO", hint: "BRISA"}, {word: "TRUENO", hint: "RAYO"},
      {word: "ARCO√çRIS", hint: "COLOR"}, {word: "MAR", hint: "OC√âANO"}, {word: "OLA", hint: "MAREA"},
      {word: "PLAYA", hint: "ARENA"}, {word: "ROCA", hint: "PIEDRA"}, {word: "MONTA√ëA", hint: "PICO"},
      {word: "VALLE", hint: "LLANURA"}, {word: "COLINA", hint: "ELEVACI√ìN"}, {word: "R√çO", hint: "CORRIENTE"},
      {word: "CASCADA", hint: "SALTO"}, {word: "FUEGO", hint: "LLAMA"}, {word: "HIELO", hint: "FR√çO"},
      {word: "TIERRA", hint: "SUELO"}, {word: "BARRO", hint: "FANGO"}, {word: "CRISTAL", hint: "MINERAL"},
      {word: "ORO", hint: "METAL"}, {word: "DIAMANTE", hint: "GEMA"}, {word: "VOLC√ÅN", hint: "LAVA"},
      {word: "TERREMOTO", hint: "TEMBLOR"}, {word: "HURAC√ÅN", hint: "CICL√ìN"}, {word: "TORNADO", hint: "TORBELLINO"},
      {word: "ECLIPSE", hint: "SOMBRA"}, {word: "COMETA", hint: "COLA"}
    ],
    "Transportes": [
      {word: "COCHE", hint: "AUTOM√ìVIL"}, {word: "MOTO", hint: "MOTOCICLETA"}, {word: "BICICLETA", hint: "PEDAL"},
      {word: "AUTOB√öS", hint: "TRANSPORTE"}, {word: "TREN", hint: "FERROCARRIL"}, {word: "METRO", hint: "SUBTERR√ÅNEO"},
      {word: "TRANV√çA", hint: "RA√çL"}, {word: "AVI√ìN", hint: "VUELO"}, {word: "HELIC√ìPTERO", hint: "ROTOR"},
      {word: "BARCO", hint: "BUQUE"}, {word: "YATE", hint: "EMBARCACI√ìN"}, {word: "VELERO", hint: "VELA"},
      {word: "LANCHA", hint: "MOTOR"}, {word: "SUBMARINO", hint: "SUMERGIBLE"}, {word: "CAMI√ìN", hint: "CARGA"},
      {word: "FURGONETA", hint: "VAN"}, {word: "TAXI", hint: "SERVICIO"}, {word: "AMBULANCIA", hint: "EMERGENCIA"},
      {word: "BOMBEROS", hint: "SIRENA"}, {word: "POLIC√çA", hint: "PATRULLA"}, {word: "COHETE", hint: "ESPACIO"},
      {word: "GLOBO", hint: "AIRE"}, {word: "PARACA√çDAS", hint: "DESCENSO"}, {word: "TELEF√âRICO", hint: "CABLE"},
      {word: "FUNICULAR", hint: "INCLINADO"}, {word: "PATINETE", hint: "RUEDA"}, {word: "MONOPAT√çN", hint: "TABLA"},
      {word: "TRINEO", hint: "NIEVE"}, {word: "CANOA", hint: "REMO"}, {word: "KAYAK", hint: "PALA"},
      {word: "CARRUAJE", hint: "CABALLO"}, {word: "CAMELLO", hint: "JOROBA"}, {word: "ELEFANTE", hint: "TROMPA"},
      {word: "TRINEO", hint: "PERRO"}, {word: "TELEF√âRICO", hint: "G√ìNDOLA"}
    ],
    "M√∫sica": [
      {word: "GUITARRA", hint: "CUERDA"}, {word: "PIANO", hint: "TECLA"}, {word: "BATER√çA", hint: "TAMBOR"},
      {word: "VIOL√çN", hint: "ARCO"}, {word: "TROMPETA", hint: "VIENTO"}, {word: "FLAUTA", hint: "SOPLO"},
      {word: "SAXOF√ìN", hint: "BOQUILLA"}, {word: "TAMBOR", hint: "PARCHE"}, {word: "ARPA", hint: "CUERDAS"},
      {word: "ACORDE√ìN", hint: "FUELLE"}, {word: "VIOLONCHELO", hint: "GRAVE"}, {word: "CONTRABAJO", hint: "CUERDAS"},
      {word: "CLARINETE", hint: "LENG√úETA"}, {word: "OBOE", hint: "CA√ëA"}, {word: "TUBA", hint: "METAL"},
      {word: "XIL√ìFONO", hint: "L√ÅMINA"}, {word: "MARACAS", hint: "PERCUSI√ìN"}, {word: "PANDERETA", hint: "CASCABEL"},
      {word: "CASTA√ëUELAS", hint: "TABLILLAS"}, {word: "TRI√ÅNGULO", hint: "METAL"}, {word: "GONG", hint: "DISCO"},
      {word: "TIMBAL", hint: "BOMBO"}, {word: "ARM√ìNICA", hint: "SOPLO"}, {word: "UKELELE", hint: "HAWAIANO"},
      {word: "BANJO", hint: "CUERDA"}, {word: "MANDOLINA", hint: "PLECTRO"}, {word: "GAITA", hint: "ESCOC√âS"},
      {word: "√ìRGANO", hint: "TUBOS"}, {word: "SINTETIZADOR", hint: "ELECTR√ìNICO"}, {word: "THEREMIN", hint: "ONDAS"},
      {word: "DJEMBE", hint: "AFRICANO"}, {word: "BONG√ì", hint: "PAREJA"}, {word: "CONGA", hint: "LATINO"},
      {word: "SITAR", hint: "INDIO"}, {word: "BALALAICA", hint: "RUSO"}
    ],
    "Ropa": [
      {word: "CAMISA", hint: "BOT√ìN"}, {word: "PANTAL√ìN", hint: "PIERNA"}, {word: "VESTIDO", hint: "FALDA"},
      {word: "CHAQUETA", hint: "ABRIGO"}, {word: "JERSEY", hint: "LANA"}, {word: "CAMISETA", hint: "MANGA"},
      {word: "FALDA", hint: "PLIEGUE"}, {word: "ZAPATO", hint: "PIE"}, {word: "BOTA", hint: "TAC√ìN"},
      {word: "ZAPATILLA", hint: "DEPORTIVA"}, {word: "SANDALIA", hint: "TIRA"}, {word: "CALCET√çN", hint: "MEDIA"},
      {word: "BUFANDA", hint: "CUELLO"}, {word: "GUANTE", hint: "MANO"}, {word: "GORRO", hint: "CABEZA"},
      {word: "SOMBRERO", hint: "ALA"}, {word: "CORBATA", hint: "NUDO"}, {word: "PAJARITA", hint: "MO√ëO"},
      {word: "CINTUR√ìN", hint: "HEBILLA"}, {word: "TIRANTES", hint: "SUJECI√ìN"}, {word: "ROPA INTERIOR", hint: "PRENDA"},
      {word: "SUJETADOR", hint: "SOST√âN"}, {word: "PIJAMA", hint: "DORMIR"}, {word: "BATA", hint: "CASA"},
      {word: "TRAJE", hint: "ELEGANTE"}, {word: "ESMOQUIN", hint: "GALA"}, {word: "BIKINI", hint: "BA√ëADOR"},
      {word: "BA√ëADOR", hint: "PLAYA"}, {word: "CHALECO", hint: "SIN MANGA"}, {word: "POLO", hint: "CUELLO"},
      {word: "SUDADERA", hint: "CAPUCHA"}, {word: "LEGGINS", hint: "AJUSTADO"}, {word: "VAQUEROS", hint: "DENIM"},
      {word: "PARKA", hint: "CAPUCHA"}, {word: "IMPERMEABLE", hint: "LLUVIA"}
    ]
  };

  const GameState = {
    screen: "menu",
    numPlayers: CONFIG.DEFAULT_PLAYERS,
    category: null,
    playerNames: [],
    secretWord: null,
    hintWord: null,
    impostorIndex: null,
    currentRevealPlayer: 0,
    votingSelectedIndex: null,
    roundNumber: 1,
    
    reset() {
      this.screen = "setup_names";
      this.category = null;
      this.playerNames = [];
      this.secretWord = null;
      this.hintWord = null;
      this.impostorIndex = null;
      this.currentRevealPlayer = 0;
      this.votingSelectedIndex = null;
      this.roundNumber = 1;
    },
    
    startNewGame() {
      const categoryKeys = Object.keys(WORD_CATEGORIES);
      this.category = Utils.pickRandom(categoryKeys);
      
      const words = WORD_CATEGORIES[this.category] || [];
      if (words.length === 0) {
        console.error('No hay palabras disponibles');
        return false;
      }
      
      const selectedWord = Utils.pickRandom(words);
      this.secretWord = selectedWord.word;
      this.hintWord = selectedWord.hint;
      this.impostorIndex = Math.floor(Math.random() * this.numPlayers);
      this.currentRevealPlayer = 0;
      this.votingSelectedIndex = null;
      this.roundNumber = 1;
      this.screen = "reveal_intro";
      return true;
    }
  };

  const Utils = {
    pickRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    },
    
    clamp(value, min, max) {
      return Math.min(max, Math.max(min, value));
    },
    
    sanitizeHTML(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    },
    
    createElement(tag, className, attributes = {}) {
      const element = document.createElement(tag);
      if (className) element.className = className;
      Object.entries(attributes).forEach(([key, value]) => {
        if (key === 'textContent' || key === 'innerHTML') {
          element[key] = value;
        } else {
          element.setAttribute(key, value);
        }
      });
      return element;
    }
  };

  const Storage = {
    save() {
      try {
        const data = {
          numPlayers: GameState.numPlayers
        };
        localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(data));
        return true;
      } catch (error) {
        console.warn('No se pudo guardar en localStorage:', error);
        return false;
      }
    },
    
    load() {
      try {
        const text = localStorage.getItem(CONFIG.STORAGE_KEY);
        if (!text) return false;
        
        const data = JSON.parse(text);
        
        if (typeof data.numPlayers === "number") {
          GameState.numPlayers = Utils.clamp(
            data.numPlayers, 
            CONFIG.MIN_PLAYERS, 
            CONFIG.MAX_PLAYERS
          );
        }
        
        return true;
      } catch (error) {
        console.warn('No se pudo cargar desde localStorage:', error);
        return false;
      }
    }
  };

  const Renderer = {
    appRoot: null,
    
    init() {
      this.appRoot = document.getElementById("main");
      if (!this.appRoot) {
        console.error('No se encontr√≥ el elemento #main');
      }
    },
    
    render() {
      if (!this.appRoot) return;
      
      this.appRoot.innerHTML = "";
      
      const viewFn = Views[GameState.screen] || Views.menu;
      const view = viewFn();
      
      if (view) {
        this.appRoot.appendChild(view);
      }
    }
  };

  const Components = {
    createCard(config = {}) {
      const card = Utils.createElement('div', 'card');
      
      if (config.title || config.chip) {
        const header = Utils.createElement('div', 'card-header');
        
        if (config.title) {
          const title = Utils.createElement('div', 'card-title', {
            textContent: config.title
          });
          header.appendChild(title);
        }
        
        if (config.chip) {
          const chipClass = config.chipType === 'impostor' ? 'chip chip-imp' : 'chip';
          const chip = Utils.createElement('div', chipClass, {
            textContent: config.chip
          });
          header.appendChild(chip);
        }
        
        card.appendChild(header);
      }
      
      if (config.content) {
        if (typeof config.content === 'string') {
          const content = document.createElement('div');
          content.innerHTML = config.content;
          card.appendChild(content);
        } else {
          card.appendChild(config.content);
        }
      }
      
      return card;
    },
    
    createButton(text, onClick, options = {}) {
      const className = options.secondary ? 'secondary' : 
                       options.danger ? 'danger' : '';
      
      const button = Utils.createElement('button', className, {
        textContent: text,
        type: 'button',
        'aria-label': options.ariaLabel || text
      });
      
      if (options.disabled) {
        button.disabled = true;
      }
      
      if (onClick) {
        button.addEventListener('click', onClick);
      }
      
      return button;
    },
    
    createField(label, inputElement, id) {
      const field = Utils.createElement('div', 'field');
      
      const labelEl = Utils.createElement('label', '', {
        textContent: label,
        for: id
      });
      
      inputElement.id = id;
      
      field.appendChild(labelEl);
      field.appendChild(inputElement);
      
      return field;
    },
    
    createSteps(activeStep = 0, totalSteps = 3) {
      const container = Utils.createElement('div', 'steps');
      
      for (let i = 0; i < totalSteps; i++) {
        const dot = Utils.createElement('div', i === activeStep ? 'dot active' : 'dot', {
          'aria-label': `Paso ${i + 1} de ${totalSteps}`,
          role: 'presentation'
        });
        container.appendChild(dot);
      }
      
      return container;
    }
  };

  const Views = {
    menu() {
      const content = document.createElement('div');
      content.innerHTML = `
        <h2 class="center">¬øListos para encontrar al impostor?</h2>
        <p class="center muted">
          En cada partida se seleccionar√° aleatoriamente una categor√≠a y una palabra secreta. ¬°M√°xima variedad en cada ronda!
        </p>
      `;
      
      const statsGrid = Utils.createElement('div', 'stats-grid');
      statsGrid.innerHTML = `
        <div class="stat-box">
          <span class="stat-number">12</span>
          <span class="stat-label">Categor√≠as</span>
        </div>
        <div class="stat-box">
          <span class="stat-number">420</span>
          <span class="stat-label">Palabras</span>
        </div>
      `;
      content.appendChild(statsGrid);
      
      const playersInput = Utils.createElement('input', '', {
        type: 'number',
        min: CONFIG.MIN_PLAYERS,
        max: CONFIG.MAX_PLAYERS,
        step: 1,
        value: GameState.numPlayers,
        'aria-required': 'true'
      });
      
      const playersField = Components.createField(
        'N√∫mero de jugadores',
        playersInput,
        'menuPlayers'
      );
      
      content.appendChild(playersField);
      
      const categories = Utils.createElement('p', 'muted', {
        innerHTML: `
          <strong>üìÇ Categor√≠as:</strong> Comida ¬∑ Lugares ¬∑ Objetos ¬∑ Animales ¬∑ Profesiones ¬∑ Deportes ¬∑ Pa√≠ses ¬∑ Tecnolog√≠a ¬∑ Naturaleza ¬∑ Transportes ¬∑ M√∫sica ¬∑ Ropa
        `
      });
      content.appendChild(categories);
      
      const card = Components.createCard({
        title: 'Bienvenido',
        chip: 'Aleatorio ¬∑ Mega',
        content: content
      });
      
      const btnRow = Utils.createElement('div', 'btn-row');
      
      const playBtn = Components.createButton('Configurar partida', () => {
        const n = parseInt(playersInput.value, 10);
        
        GameState.numPlayers = isNaN(n) ? CONFIG.DEFAULT_PLAYERS : 
          Utils.clamp(n, CONFIG.MIN_PLAYERS, CONFIG.MAX_PLAYERS);
        
        Storage.save();
        GameState.screen = "setup_names";
        Renderer.render();
      }, { ariaLabel: 'Configurar nueva partida' });
      
      btnRow.appendChild(playBtn);
      card.appendChild(btnRow);
      
      return card;
    },
    
    setup_names() {
      const content = document.createElement('div');
      content.innerHTML = `
        <h2 class="center">Introduce los nombres</h2>
        <p class="muted center">
          Opcional: pod√©is poner vuestros nombres para identificaros mejor durante la partida.
        </p>
      `;
      
      const grid = Utils.createElement('div', 'players-grid');
      
      for (let i = 0; i < GameState.numPlayers; i++) {
        const input = Utils.createElement('input', '', {
          type: 'text',
          placeholder: `Jugador ${i + 1}`,
          maxlength: 15,
          'data-player': i,
          'aria-label': `Nombre del jugador ${i + 1}`
        });
        
        if (GameState.playerNames[i]) {
          input.value = GameState.playerNames[i];
        }
        
        const field = Components.createField(
          `Jugador ${i + 1}`,
          input,
          `playerName${i}`
        );
        
        grid.appendChild(field);
      }
      
      content.appendChild(grid);
      
      const tip = Utils.createElement('p', 'muted center', {
        innerHTML: `
          Si no introduces nombres, se usar√° "Jugador 1", "Jugador 2", etc.<br><br>
          <strong>üé≤ Se elegir√°n aleatoriamente: 1 de 12 categor√≠as + 1 de 35 palabras por categor√≠a</strong>
        `,
        style: 'margin-top: 12px;'
      });
      content.appendChild(tip);
      
      const card = Components.createCard({
        title: 'Nombres de jugadores',
        chip: `${GameState.numPlayers} jugadores`,
        content: content
      });
      
      const btnRow = Utils.createElement('div', 'btn-row');
      
      const startBtn = Components.createButton('Empezar partida', () => {
        GameState.playerNames = [];
        for (let i = 0; i < GameState.numPlayers; i++) {
          const input = document.querySelector(`[data-player="${i}"]`);
          const name = input ? input.value.trim() : '';
          GameState.playerNames.push(name || `Jugador ${i + 1}`);
        }
        
        if (GameState.startNewGame()) {
          Renderer.render();
        }
      }, { ariaLabel: 'Empezar la partida con categor√≠a aleatoria' });
      
      const backBtn = Components.createButton('Volver', () => {
        GameState.screen = "menu";
        Renderer.render();
      }, { 
        secondary: true,
        ariaLabel: 'Volver al men√∫'
      });
      
      btnRow.appendChild(startBtn);
      btnRow.appendChild(backBtn);
      card.appendChild(btnRow);
      
      return card;
    },
    
    reveal_intro() {
      const current = GameState.currentRevealPlayer;
      const playerName = GameState.playerNames[current] || `Jugador ${current + 1}`;
      
      const content = document.createElement('div');
      content.className = 'center';
      content.innerHTML = `
        <h2>Pasa el m√≥vil a</h2>
        <div class="player-name-display">${Utils.sanitizeHTML(playerName)}</div>
        <p class="muted">
          Que nadie m√°s mire la pantalla. Cuando est√© listo, que toque el bot√≥n para ver su rol secreto.
        </p>
        <div class="center">
          <span class="category-display">üìÇ ${Utils.sanitizeHTML(GameState.category)}</span>
        </div>
      `;
      
      const steps = Components.createSteps(0);
      content.appendChild(steps);
      
      const card = Components.createCard({
        title: 'Mirar rol',
        chip: `${current + 1} de ${GameState.numPlayers}`,
        content: content
      });
      
      const btnRow = Utils.createElement('div', 'btn-row');
      
      const showBtn = Components.createButton('Ver mi rol', () => {
        GameState.screen = "reveal_role";
        Renderer.render();
      }, { ariaLabel: `${playerName}: Ver mi rol secreto` });
      
      btnRow.appendChild(showBtn);
      card.appendChild(btnRow);
      
      return card;
    },
    
    reveal_role() {
      const idx = GameState.currentRevealPlayer;
      const isImpostor = idx === GameState.impostorIndex;
      const current = idx + 1;
      const playerName = GameState.playerNames[idx] || `Jugador ${current}`;
      
      const content = document.createElement('div');
      content.className = 'center';
      
      if (isImpostor) {
        content.innerHTML = `
          <div class="player-name-display">${Utils.sanitizeHTML(playerName)}</div>
          <p class="muted">
            ¬°Eres el IMPOSTOR! No conoces la palabra exacta, pero te damos una pista relacionada. Debes fingir que sabes la palabra real.
          </p>
          <div class="word word-hint word-secret" role="status" aria-live="polite">
            Tu pista: ${Utils.sanitizeHTML(GameState.hintWord)}
          </div>
          <p class="muted">
            Categor√≠a: <strong>${Utils.sanitizeHTML(GameState.category)}</strong><br>
            Usa esta pista para deducir la palabra real y da pistas cre√≠bles sin revelar que no la conoces.
          </p>
        `;
      } else {
        content.innerHTML = `
          <div class="player-name-display">${Utils.sanitizeHTML(playerName)}</div>
          <p class="muted">
            Memoriza la palabra secreta. Luego pasa el m√≥vil boca abajo al siguiente jugador.
          </p>
          <div class="word" role="status" aria-live="polite">
            ${Utils.sanitizeHTML(GameState.secretWord)}
          </div>
          <p class="muted">
            Categor√≠a: <strong>${Utils.sanitizeHTML(GameState.category)}</strong>
          </p>
        `;
      }
      
      const steps = Components.createSteps(1);
      content.appendChild(steps);
      
      const card = Components.createCard({
        title: 'Tu rol',
        chip: isImpostor ? 'IMPOSTOR' : 'CIVIL',
        chipType: isImpostor ? 'impostor' : 'normal',
        content: content
      });
      
      const btnRow = Utils.createElement('div', 'btn-row');
      
      const nextText = (current === GameState.numPlayers)
        ? "Empezar ronda de pistas"
        : "Ocultar y pasar al siguiente";
      
      const nextBtn = Components.createButton(nextText, () => {
        if (current === GameState.numPlayers) {
          GameState.screen = "hints";
        } else {
          GameState.currentRevealPlayer++;
          GameState.screen = "reveal_intro";
        }
        Renderer.render();
      }, { ariaLabel: nextText });
      
      btnRow.appendChild(nextBtn);
      card.appendChild(btnRow);
      
      return card;
    },
    
    hints() {
      const content = document.createElement('div');
      content.className = 'center';
      content.innerHTML = `
        <div class="center" style="margin-bottom: 12px;">
          <span class="category-display">üìÇ ${Utils.sanitizeHTML(GameState.category)}</span>
        </div>
        <h2>Es vuestro turno de hablar</h2>
        <p class="muted">
          Uno por uno, cada jugador dice <strong>una palabra</strong> relacionada con la palabra secreta, pero sin decirla exacta.
        </p>
        <p class="muted">
          El impostor debe escuchar con atenci√≥n y fingir que conoce la palabra, usando su pista como referencia.
        </p>
        <div class="badges">
          <span class="badge">Consejo: s√© espec√≠fico pero no obvio.</span>
          <span class="badge">Escucha dudas, silencios y contradicciones.</span>
        </div>
      `;
      
      const steps = Components.createSteps(2);
      content.appendChild(steps);
      
      const card = Components.createCard({
        title: `Ronda ${GameState.roundNumber}`,
        chip: 'Pistas de una palabra',
        content: content
      });
      
      const btnRow = Utils.createElement('div', 'btn-row');
      
      const nextRoundBtn = Components.createButton('Otra ronda de pistas', () => {
        GameState.roundNumber++;
        Renderer.render();
      }, { 
        secondary: true,
        ariaLabel: 'Iniciar otra ronda de pistas'
      });
      
      const votingBtn = Components.createButton('Ir a votaci√≥n', () => {
        GameState.screen = "voting";
        Renderer.render();
      }, { ariaLabel: 'Proceder a la votaci√≥n final' });
      
      btnRow.appendChild(nextRoundBtn);
      btnRow.appendChild(votingBtn);
      card.appendChild(btnRow);
      
      return card;
    },
    
    voting() {
      const content = document.createElement('div');
      content.innerHTML = `
        <h2 class="center">¬øQui√©n crees que es el impostor?</h2>
        <p class="muted center">
          Comentad entre todos y elegid <strong>un jugador</strong> como sospechoso principal. Tocad su nombre para marcarlo.
        </p>
      `;
      
      const list = Utils.createElement('div', 'players-list', {
        role: 'group',
        'aria-label': 'Seleccionar jugador sospechoso'
      });
      
      for (let i = 0; i < GameState.numPlayers; i++) {
        const playerName = GameState.playerNames[i] || `Jugador ${i + 1}`;
        
        const pill = Utils.createElement('button', 'player-pill', {
          type: 'button',
          'aria-pressed': GameState.votingSelectedIndex === i,
          'aria-label': playerName
        });
        
        if (GameState.votingSelectedIndex === i) {
          pill.classList.add('selected');
        }
        
        pill.innerHTML = `
          <span class="player-number">#${i + 1}</span>
          <span class="player-name">${Utils.sanitizeHTML(playerName)}</span>
        `;
        
        pill.addEventListener('click', () => {
          GameState.votingSelectedIndex = (GameState.votingSelectedIndex === i) ? null : i;
          Renderer.render();
        });
        
        list.appendChild(pill);
      }
      
      content.appendChild(list);
      
      const info = Utils.createElement('p', 'muted center', {
        textContent: 'Si no os pon√©is de acuerdo, pod√©is no marcar a nadie y descubrir el resultado igualmente.',
        style: 'margin-top: 10px;'
      });
      content.appendChild(info);
      
      const card = Components.createCard({
        title: 'Votaci√≥n',
        chip: 'Ronda final',
        content: content
      });
      
      const btnRow = Utils.createElement('div', 'btn-row');
      
      const revealBtn = Components.createButton('Revelar impostor', () => {
        GameState.screen = "result";
        Renderer.render();
      }, { 
        danger: true,
        ariaLabel: 'Revelar qui√©n es el impostor'
      });
      
      btnRow.appendChild(revealBtn);
      card.appendChild(btnRow);
      
      return card;
    },
    
    result() {
      const impostorNum = GameState.impostorIndex + 1;
      const impostorName = GameState.playerNames[GameState.impostorIndex] || `Jugador ${impostorNum}`;
      const voted = GameState.votingSelectedIndex != null ? GameState.votingSelectedIndex + 1 : null;
      const votedName = voted != null ? (GameState.playerNames[GameState.votingSelectedIndex] || `Jugador ${voted}`) : null;
      const correct = voted != null && voted === impostorNum;
      
      const title = correct ? "¬°El impostor ha sido descubierto!" : "¬°El impostor ha escapado!";
      const subtitle = correct
        ? "El grupo ha acertado la sospecha y ha desenmascarado al impostor."
        : "El grupo no ha se√±alado al impostor correcto. El impostor gana esta ronda.";
      
      const content = document.createElement('div');
      content.className = 'center';
      content.innerHTML = `
        <h2>${title}</h2>
        <p class="muted">${subtitle}</p>
        <div class="center" style="margin: 12px 0;">
          <span class="category-display">üìÇ ${Utils.sanitizeHTML(GameState.category)}</span>
        </div>
        <div class="word" role="status" aria-live="polite">
          Palabra secreta: ${Utils.sanitizeHTML(GameState.secretWord)}
        </div>
        <div class="word word-hint" style="font-size: 1.1rem; margin-top: 6px;">
          Pista del impostor: ${Utils.sanitizeHTML(GameState.hintWord)}
        </div>
        <div class="player-name-display" style="background: rgba(255,75,106,0.18); border-color: rgba(255,75,106,0.5); color: var(--danger);">
          Impostor: ${Utils.sanitizeHTML(impostorName)}
        </div>
        <p class="muted">
          Voto del grupo: ${votedName ? Utils.sanitizeHTML(votedName) : "sin voto marcado"}
        </p>
        <div class="badges">
          <span class="badge">La pr√≥xima partida tendr√° otra categor√≠a y palabra aleatorias.</span>
          <span class="badge">Sumad puntos: +1 para el equipo ganador en cada ronda.</span>
        </div>
      `;
      
      const card = Components.createCard({
        title: 'Resultado',
        chip: correct ? 'Victoria civiles' : 'Victoria impostor',
        chipType: correct ? 'normal' : 'impostor',
        content: content
      });
      
      const btnRow = Utils.createElement('div', 'btn-row');
      
      const againBtn = Components.createButton('Nueva partida aleatoria', () => {
        if (GameState.startNewGame()) {
          Renderer.render();
        }
      }, { ariaLabel: 'Comenzar una nueva partida con categor√≠a y palabra aleatorias' });
      
      const menuBtn = Components.createButton('Volver al men√∫', () => {
        GameState.reset();
        GameState.screen = "menu";
        Renderer.render();
      }, { 
        secondary: true,
        ariaLabel: 'Volver al men√∫ principal'
      });
      
      btnRow.appendChild(againBtn);
      btnRow.appendChild(menuBtn);
      card.appendChild(btnRow);
      
      return card;
    }
  };

  function init() {
    Storage.load();
    Renderer.init();
    GameState.screen = "menu";
    Renderer.render();
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
</script>
</body>
</html>
